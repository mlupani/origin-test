{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\xenei\\\\Desktop\\\\origin-test\\\\client\\\\src\\\\components\\\\actionDetail.tsx\",\n    _s = $RefreshSig$();\n\nimport { useState, useEffect, useRef, useCallback } from 'react';\nimport useAuth from '../hooks/useAuth';\nimport { useHistory, useLocation } from 'react-router-dom';\nimport twelvedata, { apikey } from '../api/twelvedataAPI';\nimport Highcharts from \"highcharts/highstock\";\nimport HighchartsReact from \"highcharts-react-official\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst ActionDetail = ({\n  match\n}) => {\n  _s();\n\n  const location = useLocation();\n  const {\n    user,\n    isLogged\n  } = useAuth();\n  const actionSelected = useRef({\n    symbol: '',\n    name: '',\n    currency: ''\n  }).current;\n  const history = useHistory();\n  const [optionSelected, setOptionSelected] = useState(0);\n  const [intervalo, setIntervalo] = useState(1);\n  const [chartOptions, setChartOptions] = useState();\n  const [values, setValues] = useState([]);\n  const [desde, setDesde] = useState('');\n  const [hasta, setHasta] = useState('');\n  const [error, setError] = useState('');\n  const [timeInterval, setTimeInterval] = useState();\n  console.log(location);\n  useEffect(() => {\n    if (isLogged === false) history.push('/');\n  }, [isLogged, history]);\n  const changeOptions = useCallback(() => {\n    setChartOptions({\n      series: [{\n        data: values.map(({\n          value\n        }) => value),\n        name: 'Cotización',\n        enablePolling: true,\n        dataRefreshRate: intervalo\n      }],\n      title: {\n        text: actionSelected.symbol\n      },\n      xAxis: [{\n        tickintervalo: 1,\n        title: {\n          text: 'intervalo'\n        },\n        labels: {\n          enabled: true,\n          formatter: val => values[val.value].date\n        }\n      }],\n      yAxis: [{\n        title: {\n          text: 'Cotizacion'\n        }\n      }]\n    });\n  }, [intervalo, actionSelected.symbol, values]);\n  useEffect(() => {\n    changeOptions();\n  }, [values, changeOptions]);\n\n  const graficar = async () => {\n    const time = setInterval(() => loadValues(), intervalo * 60000);\n    setTimeInterval(time);\n  };\n\n  const loadValues = async () => {\n    clearInterval(timeInterval);\n    setError('');\n    let newValues = [];\n\n    if (optionSelected === 0) {\n      try {\n        const res = await twelvedata.get(`https://api.twelvedata.com/time_series?symbol=${actionSelected.symbol}&interval=${intervalo}min&apikey=${apikey}`);\n        newValues = res.data.values.map(({\n          datetime,\n          open\n        }) => {\n          const d = new Date(datetime);\n          const date = d.getHours() + ':' + (d.getMinutes() < 10 ? '0' : '') + d.getMinutes();\n          return {\n            date,\n            value: +open\n          };\n        });\n        setValues(newValues.reverse().slice(newValues.length - 5, newValues.length));\n        graficar();\n      } catch (error) {\n        console.log(`https://api.twelvedata.com/time_series?symbol=${actionSelected.symbol}&interval=${intervalo}min&apikey=${apikey}`);\n        console.log(error);\n      }\n    }\n\n    if (optionSelected === 1) {\n      if (desde.trim() === '' || hasta.trim() === '') {\n        setError('Por favor seleccione una fecha de inicio y de fin');\n        return false;\n      }\n\n      const date_desde = new Date(desde);\n      const date_hasta = new Date(hasta);\n\n      if (date_desde > date_hasta) {\n        setError('Por favor seleccione una fecha de inicio menor a la de fin');\n        return false;\n      }\n\n      try {\n        const res = await twelvedata.get(`https://api.twelvedata.com/time_series?symbol=${actionSelected.symbol}&interval=${intervalo}min&start_date=${desde}%2009:48:00&end_date=${hasta}%2019:48:00&apikey=${apikey}`);\n        newValues = res.data.values.map(({\n          datetime,\n          open\n        }) => {\n          const d = new Date(datetime);\n          const date = d.getHours() + ':' + (d.getMinutes() < 10 ? '0' : '') + d.getMinutes();\n          return {\n            date,\n            value: +open\n          };\n        });\n        setValues(newValues.reverse().slice(newValues.length - 5, newValues.length));\n        graficar();\n      } catch (error) {\n        console.log(`https://api.twelvedata.com/time_series?symbol=${actionSelected.symbol}&interval=${intervalo}min&start_date=${desde}%2009:48:00&end_date=${hasta}%2019:48:00&apikey=${apikey}`);\n        console.log(error);\n      }\n    }\n  };\n\n  const changeinterval = val => {\n    setIntervalo(+val);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"header\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: [actionSelected.symbol, \" - \", actionSelected.name, \" - \", actionSelected.currency]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [\"Usuario: \", user === null || user === void 0 ? void 0 : user.login]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"radio\",\n        name: \"graficar\",\n        onChange: () => setOptionSelected(0),\n        id: \"graficar\",\n        checked: optionSelected === 0 ? true : false\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 17\n      }, this), \"\\xA0\\xA0Tiempo Real\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 26\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"radio\",\n        name: \"graficar\",\n        onChange: () => setOptionSelected(1),\n        id: \"graficar\",\n        checked: optionSelected === 1 ? true : false\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 17\n      }, this), \"\\xA0\\xA0Hist\\xF3rico \\xA0\\xA0 Desde \", /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"date\",\n        onChange: e => setDesde(e.target.value),\n        placeholder: \"Desde\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 23\n      }, this), \"\\xA0\\xA0\\xA0\\xA0 Hasta \", /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"date\",\n        onChange: e => setHasta(e.target.value),\n        placeholder: \"Hasta\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 23\n      }, this), error && /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          marginTop: 20\n        },\n        className: \"text-danger\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 27\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: 50,\n        display: 'flex',\n        width: 500,\n        justifyContent: 'flex-start'\n      },\n      children: [\"\\xA0\\xA0Intervalo\\xA0\\xA0\\xA0\\xA0\", /*#__PURE__*/_jsxDEV(\"select\", {\n        onChange: e => changeinterval(e.target.value),\n        name: \"intervaloo\",\n        id: \"intervaloo\",\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"1\",\n          children: \"1 Minuto\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"5\",\n          children: \"5 Minutos\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"15\",\n          children: \"15 Minutos\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 157,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"grafico\",\n      style: {\n        marginTop: 50,\n        display: 'flex',\n        width: 500,\n        justifyContent: 'space-between'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => history.goBack(),\n        className: \"btn btn-warning btn-sm\",\n        children: \"Volver\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: loadValues,\n        className: \"btn btn-primary btn-sm\",\n        children: \"Graficar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: 50,\n        display: 'flex',\n        width: 800,\n        justifyContent: 'flex-start'\n      },\n      children: values.length ? /*#__PURE__*/_jsxDEV(HighchartsReact, {\n        highcharts: Highcharts,\n        options: chartOptions\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 37\n      }, this) : ''\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 132,\n    columnNumber: 9\n  }, this);\n};\n\n_s(ActionDetail, \"wQ5hgAmITeOFiUYxe8BwuWZ5khU=\", false, function () {\n  return [useLocation, useAuth, useHistory];\n});\n\n_c = ActionDetail;\nexport default ActionDetail;\n\nvar _c;\n\n$RefreshReg$(_c, \"ActionDetail\");","map":{"version":3,"sources":["C:/Users/xenei/Desktop/origin-test/client/src/components/actionDetail.tsx"],"names":["useState","useEffect","useRef","useCallback","useAuth","useHistory","useLocation","twelvedata","apikey","Highcharts","HighchartsReact","ActionDetail","match","location","user","isLogged","actionSelected","symbol","name","currency","current","history","optionSelected","setOptionSelected","intervalo","setIntervalo","chartOptions","setChartOptions","values","setValues","desde","setDesde","hasta","setHasta","error","setError","timeInterval","setTimeInterval","console","log","push","changeOptions","series","data","map","value","enablePolling","dataRefreshRate","title","text","xAxis","tickintervalo","labels","enabled","formatter","val","date","yAxis","graficar","time","setInterval","loadValues","clearInterval","newValues","res","get","datetime","open","d","Date","getHours","getMinutes","reverse","slice","length","trim","date_desde","date_hasta","changeinterval","login","e","target","marginTop","display","width","justifyContent","goBack"],"mappings":"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","sourcesContent":["import { useState, useEffect, useRef, useCallback } from 'react';\r\nimport useAuth from '../hooks/useAuth';\r\nimport { useHistory, useLocation } from 'react-router-dom';\r\nimport twelvedata, {apikey} from '../api/twelvedataAPI';\r\n\r\nimport Highcharts from \"highcharts/highstock\";\r\nimport HighchartsReact from \"highcharts-react-official\";\r\n\r\n\r\nconst ActionDetail = ({match}: any) => {\r\n\r\n    const location = useLocation()\r\n    const { user, isLogged } = useAuth();\r\n    const actionSelected = useRef({symbol:'', name:'', currency: ''}).current\r\n    const history = useHistory();\r\n    const [optionSelected, setOptionSelected] = useState(0)\r\n    const [intervalo, setIntervalo] = useState(1)\r\n    const [chartOptions, setChartOptions] = useState<any>();\r\n    const [values, setValues] = useState<any>([])\r\n    const [desde, setDesde] = useState('')\r\n    const [hasta, setHasta] = useState('')\r\n    const [error, setError] = useState('')\r\n    const [timeInterval, setTimeInterval] = useState<any>()\r\n\r\n    console.log(location);\r\n\r\n    useEffect(() => {\r\n        if(isLogged === false)\r\n            history.push('/')\r\n\r\n    }, [isLogged, history])\r\n\r\n    const changeOptions = useCallback(() => {\r\n            setChartOptions({\r\n                series: [\r\n                    {\r\n                        data: values.map(({value}: any) => value),\r\n                        name:'Cotización',\r\n                        enablePolling: true,\r\n                        dataRefreshRate: intervalo\r\n                    },\r\n                ],\r\n                title: {\r\n                    text:actionSelected.symbol\r\n                },\r\n                xAxis: [{\r\n                    tickintervalo: 1,\r\n                    title: {\r\n                        text: 'intervalo',\r\n                    },\r\n                    labels: {\r\n                            enabled: true,\r\n                            formatter: (val: any) => values[val.value].date\r\n                        }\r\n                }],\r\n                yAxis: [{\r\n                    title: {\r\n                        text: 'Cotizacion'\r\n                    }\r\n                }],\r\n            })\r\n        },[intervalo, actionSelected.symbol, values])\r\n\r\n    useEffect(() => {\r\n        changeOptions()\r\n    }, [values, changeOptions])\r\n\r\n    const graficar = async () => {\r\n        const time = setInterval(() => loadValues(),intervalo * 60000)\r\n        setTimeInterval(time)\r\n    }\r\n\r\n    const loadValues = async () => {\r\n\r\n        clearInterval(timeInterval)\r\n        setError('')\r\n        let newValues = [];\r\n\r\n        if(optionSelected === 0){\r\n            try {\r\n                const res = await twelvedata.get(`https://api.twelvedata.com/time_series?symbol=${actionSelected.symbol}&interval=${intervalo}min&apikey=${apikey}`)\r\n                newValues = res.data.values.map(({datetime,open}: any) => {\r\n                    const d = new Date(datetime)\r\n                    const date = d.getHours()+':'+(d.getMinutes()<10?'0':'') + d.getMinutes();\r\n                    return {date, value: +open }\r\n                })\r\n                setValues(newValues.reverse().slice(newValues.length - 5,newValues.length))\r\n                graficar()\r\n            } catch (error) {\r\n                console.log(`https://api.twelvedata.com/time_series?symbol=${actionSelected.symbol}&interval=${intervalo}min&apikey=${apikey}`);\r\n                console.log(error);\r\n            }\r\n        }\r\n\r\n        if(optionSelected === 1){\r\n\r\n            if(desde.trim() === '' || hasta.trim() === '') {\r\n                setError('Por favor seleccione una fecha de inicio y de fin')\r\n                return false;\r\n            }\r\n\r\n            const date_desde = new Date(desde);\r\n            const date_hasta = new Date(hasta);\r\n\r\n            if(date_desde > date_hasta){\r\n                setError('Por favor seleccione una fecha de inicio menor a la de fin')\r\n                return false;\r\n            }\r\n\r\n            try {\r\n                const res = await twelvedata.get(`https://api.twelvedata.com/time_series?symbol=${actionSelected.symbol}&interval=${intervalo}min&start_date=${desde}%2009:48:00&end_date=${hasta}%2019:48:00&apikey=${apikey}`)\r\n                newValues = res.data.values.map(({datetime,open}: any) => {\r\n                    const d = new Date(datetime)\r\n                    const date = d.getHours()+':'+(d.getMinutes()<10?'0':'') + d.getMinutes();\r\n                    return {date, value: +open }\r\n                })\r\n                setValues(newValues.reverse().slice(newValues.length - 5,newValues.length))\r\n                graficar()\r\n            } catch (error) {\r\n                console.log(`https://api.twelvedata.com/time_series?symbol=${actionSelected.symbol}&interval=${intervalo}min&start_date=${desde}%2009:48:00&end_date=${hasta}%2019:48:00&apikey=${apikey}`);\r\n                console.log(error);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    const changeinterval = (val: string) => {\r\n        setIntervalo(+val)\r\n    }\r\n\r\n    return (\r\n        <div className='container'>\r\n            <div className='header'>\r\n                <p>{actionSelected.symbol} - {actionSelected.name} - {actionSelected.currency}</p>\r\n                <p>Usuario: {user?.login}</p>\r\n            </div>\r\n            <div>\r\n                <input type=\"radio\" name=\"graficar\" onChange={()=> setOptionSelected(0)} id=\"graficar\" checked={optionSelected === 0? true : false} />\r\n                &nbsp;&nbsp;Tiempo Real\r\n                <br></br><br></br>\r\n                <input type=\"radio\" name=\"graficar\" onChange={()=> setOptionSelected(1)} id=\"graficar\" checked={optionSelected === 1? true : false} />\r\n                &nbsp;&nbsp;Histórico\r\n\r\n                &nbsp;&nbsp;\r\n                Desde <input type='date' onChange={(e)=>setDesde(e.target.value)} placeholder='Desde' />\r\n                &nbsp;&nbsp;&nbsp;&nbsp;\r\n                Hasta <input type='date' onChange={(e)=>setHasta(e.target.value)} placeholder='Hasta' />\r\n\r\n                {error && <p style={{marginTop: 20}} className='text-danger'>{error}</p>}\r\n\r\n            </div>\r\n            <div style={{marginTop: 50, display:'flex', width:500, justifyContent: 'flex-start'}}>\r\n                &nbsp;&nbsp;Intervalo&nbsp;&nbsp;&nbsp;&nbsp;\r\n                <select onChange={(e) => changeinterval(e.target.value)} name=\"intervaloo\" id=\"intervaloo\">\r\n                    <option value=\"1\">1 Minuto</option>\r\n                    <option value=\"5\">5 Minutos</option>\r\n                    <option value=\"15\">15 Minutos</option>\r\n                </select>\r\n            </div>\r\n            <div id='grafico' style={{marginTop: 50, display:'flex', width:500, justifyContent: 'space-between'}}>\r\n                <button onClick={() => history.goBack()} className='btn btn-warning btn-sm'>Volver</button>\r\n                <button onClick={loadValues} className='btn btn-primary btn-sm'>Graficar</button>\r\n            </div>\r\n            <div style={{marginTop: 50, display:'flex', width:800, justifyContent: 'flex-start'}}>\r\n                {\r\n                    values.length ? <HighchartsReact highcharts={Highcharts} options={chartOptions} /> : ''\r\n                }\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default ActionDetail\r\n"]},"metadata":{},"sourceType":"module"}